#!/bin/sh

# Parameter file

input_params="input_params"

# Ensure scipy libraries are loaded
# Used here is the Astroconda distribution

source activate astroconda

# Store input_params as variables
# grep retrieves line containing variable
# then grep output is fed into another grep
# command to retrieve its numerical value
# Values can be any size, and integer or float
# In some cases, signed values are allowed

# For the match file, it must be the second string
# in the line, separated by spaces on either side

Nartstar=`grep "N_artstar" input_params | grep -o '[+-]\?[0-9]\+[\.]\?[0-9]\+'` 
TRGB_mag=`grep "TRGB_mag" input_params | grep -o '[+-]\?[0-9]\+[\.]\?[0-9]\+'` 
RGB_max=`grep "RGB_max" input_params | grep -o '[+-]\?[0-9]\+[\.]\?[0-9]\+'` 
AGB_min=`grep "AGB_min" input_params | grep -o '[+-]\?[0-9]\+[\.]\?[0-9]\+'` 
RGB_slope=`grep "RGB_slope" input_params | grep -o '[+-]\?[0-9]\+[\.]\?[0-9]\+'` 
AGB_slope=`grep "AGB_slope" input_params | grep -o '[+-]\?[0-9]\+[\.]\?[0-9]\+'` 
X_image_dim=`grep "X_image_dim" input_params | grep -o '[+-]\?[0-9]\+[\.]\?[0-9]\+'` 
Y_image_dim=`grep "Y_image_dim" input_params | grep -o '[+-]\?[0-9]\+[\.]\?[0-9]\+'` 
RGB_AGB_ratio=`grep "RGB_AGB_ratio" input_params | grep -o '[\.]\?[0-9]\+[\.]\?[0-9]\+'` 
TRGB_interface=`grep "TRGB_interface" input_params | grep -o '[0-9]\+[\.]\?[0-9]\+'` 
min_color=`grep "min_color" input_params | grep -o '[+-]\?[0-9]\+[\.]\?[0-9]\+'` 
max_color=`grep "max_color" input_params | grep -o '[+-]\?[0-9]\+[\.]\?[0-9]\+'` 
match_file=`grep "match_file" input_params | awk -F ' ' '{print $2}' ` 


# Generate the RGB luminosity function

python gen_lf.py --nartstar $Nartstar --magrange $TRGB_mag $RGB_max --slope $RGB_slope --outfile rgb_lum_fcn.dat 

# Generate the AGB luminosity function

python gen_lf.py --nartstar $Nartstar --magrange $AGB_min $RGB_max --slope $AGB_slope --outfile agb_lum_fcn.dat 

# Generate the ADDSTAR files

python gen_addstar_files.py --lfs rgb_lum_fcn.dat agb_lum_fcn.dat --imagedim $X_image_dim $Y_image_dim \
	--RGB_AGB_ratio $RGB_AGB_ratio --colors $min_color $max_color --trgbmag $TRGB_mag --nartstar $Nartstar --matchfile $match_file





